var Doc=function(e){var t=this;t._id=ko.observable(e._id);t.title=ko.observable(e.title);t.workflow_status=ko.observable(e.workflow_status);t.last_editor=ko.observable(e.last_editor);t.last_modified=ko.observable(e.last_modified);t.start_date=ko.observable(e.start_date);t.selected=ko.observable(!1)},Field=function(e){var t=this;t.name=ko.observable(e.name);t.fieldname=ko.observable(e.fieldname);t.selected=ko.observable(e.selected||!1)},ListingModelView=function(){function n(t,n,r,i){$("#pagination").pagination(n,{items_per_page:i,current_page:r,callback:function(t){e.pg(t);var n=t*i;e.offset(n);e.getData();return!1}})}var e=this;e.docs=ko.observableArray([]);content_type=$(document.body).data("content_type");e.content_type=ko.observable(content_type);var t=$("#listSearch").val();t=="Search"&&(t="");e.searchstring=ko.observable("");e.offset=ko.observable(0);e.pg=ko.observable(0);e.selected_count=ko.observable(0);e.order_by=ko.observable("last_modified DESC");e.fields=ko.observableArray([new Field({name:"Title",fieldname:"title"}),new Field({name:"Last Edit",fieldname:"last_modified",selected:"desc"}),new Field({name:"Edited By",fieldname:"last_editor"}),new Field({name:"Start Date",fieldname:"start_date"}),new Field({name:"Workflow",fieldname:"workflow_status"})]);e.getData=function(){$.getJSON($(document.body).data("base_url")+"api/content?jsoncallback=?",{offset:e.offset(),search:e.searchstring(),content_type:e.content_type(),order_by:e.order_by(),api_key:$(document.body).data("api_key"),limit:100,fields:["id","title","last_modified","live","start_date","workflow_status","last_editor"]},function(t){var r=_.map(t.content,function(e){return new Doc(e)});e.docs(r);n(content_type,t.count,e.pg(),100)}).error(function(e,t,n){$("#msgdialog-header").html("Error");$("#msgdialog-body").html("<h4>"+t+"</h4><p>"+e.responseText+"</p>");$("#msgdialog-buttons").html('<button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>');$("#msgdialog").modal()})};e.clickSearch=function(){e.getData()};e.clickWorkflow=function(t,n){var r=$(n.target).attr("data-workflow"),i=[];_.each(e.docs(),function(e){e.selected()&&i.push({id:e._id(),workflow_status:r})});$.getJSON($(document.body).data("base_url")+"api/content/multiple/change_workflow?jsoncallback=?",{items:i,api_key:$(document.body).data("api_key")},function(t){_.each(e.docs(),function(e){e.selected()&&e.workflow_status(r)})})};e.clickDelete=function(t,n){var r=[];_.each(e.docs(),function(e){e.selected()&&r.push({id:e._id()})});e.selected_count(r.length);if(r.length==0){$("#msgdialog-header").html("Confirm Delete");$("#msgdialog-body").html("<h4>No documents selected</h4> <p>Please select some documents by ticking the checkboxes</p>");$("#msgdialog-buttons").html('<button class="btn" data-dismiss="modal" aria-hidden="true">Okay</button>');$("#msgdialog").modal();return!1}$("#msgdialogDelete").modal("show")};e.clickDoDelete=function(t,n){var r=[];_.each(e.docs(),function(e){e.selected()&&r.push({id:e._id()})});$.getJSON($(document.body).data("base_url")+"api/content/multiple/delete?jsoncallback=?",{items:r,api_key:$(document.body).data("api_key")},function(t){_.each(e.docs(),function(t){t.selected()&&e.docs.remove(t)})})};e.clickChangeOrder=function(t,n){var r=t.fieldname();_.each(e.fields(),function(e){e.selected(!1)});t.selected("asc");if($(n.target).attr("data-order")=="DESC"){r+=" DESC";t.selected("desc")}e.order_by(r);e.getData()};$(document).on("update",function(t,n){_.each(e.docs(),function(t){t._id()==n&&$.getJSON($(document.body).data("base_url")+"api/content/get?jsoncallback=?",{id:n,api_key:$(document.body).data("api_key")},function(n){e.docs.replace(t,new Doc(n.content))})})});$(document).on("delete",function(t,n){_.each(e.docs(),function(t){t._id()==n&&e.docs.remove(t)})});e.getData()};