function create_autocomplete_item(e,t,n,r){var i={multiple:n,contenttype:t,name:r,value:e._id},s=_.template($("#field-autocomplete-item").html(),{title:e.title,field:i,item:e});return s}function update_content(e){var t=_.template($("#"+e.template).html(),e);$("#"+e.element).html(t)}function get_wordcount(e){e.nextAll(".wordcount_container").first().find(".wordcount_result").load("/workers/ajax_edit/wordcount",{str:e.val()})}function init_form(){$(".chzn-select").chosen();$(".my-datepicker").datepicker({autoclose:!0});var e=!1;$(".autocomplete").each(function(){var n=$(this),r="",i=this;n.keyup(function(){if($.trim(r)!=$.trim(n.val())){r=n.val();clearTimeout(e);e=setTimeout(function(){var e=n.prev(),r=n.attr("multiple"),s=n.attr("fieldname"),o=n.prev().val(),u=n.parent().siblings(".options"),a=n.parent().siblings(".result_container"),f=n.attr("contenttypes"),l="/api/content/listing/",o=n.val(),c=n.parent().siblings(".indicator");while(xhr_reqs.length>0){jqXHR=xhr_reqs.pop();jqXHR.abort()}c.show();xhr_reqs.push($.getJSON("/api/content",{search:o,content_type:f,limit:20,fields:["_id","title"],order_by:"last_modified"},function(n){var o=$.extend({},e.offset(),{height:i.offsetHeight});u.css({top:o.top+o.height,left:o.left});if(n.content.length>0)u.show();else{u.hide();c.hide()}u.html("");_.each(n.content,function(n){var i=$('<li><a href="#">'+n.title+"</a></li>").click(function(i){i.stopPropagation();i.preventDefault();u.hide();a.append(create_autocomplete_item(n,t,r,s));e.val("")});u.append(i);c.hide()})}))},500)}})});$(".countchars").each(function(){if($(this).hasClass("countdown")){var e=$(this).attr("max"),t=e-$(this).val().length;t>=0?$(this).after("<div class='charcount'>"+t+" chars remaining</div>"):$(this).after("<div class='charcount red'>"+Math.abs(t)+" chars over</div>");$(this).keyup(function(){var e=$(this).attr("max"),t=e-$(this).val().length;t>=0?$(this).next().html(t+" chars remaining").removeClass("red"):$(this).next().html(Math.abs(t)+" chars over").addClass("red")})}else{var t=$(this).val().length;$(this).after("<div class='charcount'>"+t+" chars</div>");$(this).keyup(function(){t=$(this).val().length;$(this).next().html(t+" chars")})}$(this).removeClass("countchars")});$(".wysiwyg").length&&initCKEditor();var t=$(document.body).data("content_type"),n=$(document.body).data("urlid")}var xhr_reqs=[];$(function(){function e(e){var t=$(e).parent(),n="";n+=t.children(".datetime_date").val();n+=" ";n+=t.children(".datetime_hour").val()?t.children(".datetime_hour").val():"00";n+=":";n+=t.children(".datetime_minute").val()?t.children(".datetime_minute").val():"00";$(e).siblings(":hidden").val(stringToDate(n))}$(".result_container div a.close").live("click",function(){$(this).parent().remove()});$('<div class="wordcount_container">Word count:&nbsp;<div class="wordcount_result"></div></div>').insertAfter(".wordcount");$(".wordcount").keyup(function(){get_wordcount($(this))});$(".wordcount").each(function(){get_wordcount($(this))});$(".remover").live("click",function(){$(this).parent().remove();return!1});$(document).on("keydown",".datetime_hour",function(e){var t=e.keyCode;if(t>33&&t<47)return!1;if(t>58&&t<126)return!1});$(document).on("blur",".datetime_hour",function(){var e=0;if($(this).val()){e=Number($(this).val());$(this).val(leadingZeros(e));if($(this).val().length>2){var t=$(this).val();$(this).val(t.substring(t.length-2,t.length));e=parseInt($(this).val())}e>23&&$(this).val("23")}else $(this).val("00");isFinite($(this).val())||$(this).val("00")});$(document).on("blur",".datetime_minute",function(){if($(this).val()){var e=Number($(this).val());$(this).val(leadingZeros(e));if($(this).val().length>2){var t=$(this).val();$(this).val(t.substring(t.length-2,t.length));e=parseInt($(this).val())}e>59&&$(this).val("59")}else $(this).val("00");isFinite($(this).val())||$(this).val("00")});$(document).on("keydown",".datetime_minute",function(e){var t=e.keyCode;if(t>33&&t<47)return!1;if(t>58&&t<126)return!1});$(document).on("keyup",".datetime_change",function(){e(this)});$(document).on("change",".datetime_change",function(){e(this)});$(document).on("click",".deepsearch-search",function(){var e=$(this).prev().attr("multiple"),t=$(this).prev().attr("fieldname"),n=$(this).prev(),r=this,i=$(this).prev().val(),s=$(this).prev().attr("contenttype"),o=$(this).parent().siblings(".deepsearch-options"),u=$(this).parent().siblings(".deepsearch-results"),a=$(this);while(xhr_reqs.length>0){jqXHR=xhr_reqs.pop();jqXHR.abort()}a.html("<span class='label label-success'>Searching...</span>");xhr_reqs.push($.getJSON("/api/content",{search:i,content_type:s,limit:20,fields:["_id","title"],order_by:"last_modified"},function(i){var f=$.extend({},n.offset(),{height:r.offsetHeight});o.css({top:f.top+f.height,left:f.left});o.show();o.html("");_.each(i.content,function(r){var i=$('<li><a href="#">'+r.title+"</a></li>").click(function(i){i.stopPropagation();i.preventDefault();o.hide();u.append(create_autocomplete_item(r,s,e,t));n.val("")});o.append(i);a.html("Search")})}))})});